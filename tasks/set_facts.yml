---
### ALL ###
- name: set facts vault leader
  set_fact:
    "{% for host in groups['vault_leader'] %}
        vault_leader_ip_addr: {{ hostvars[host]['ansible_eth0']['ipv4']['address'] }}
        vault_leader_hostname: {{ hostvars[host]['ansible_facts']['fqdn'] }}
    {% endfor %}"

- name: set facts shamir
  set_fact:
    shares: "-key-shares"
    threshold: "-key-threshold"
  when: vault_auto_unseal == false

- name: set fact kms
  set_fact:
    shares: "-recovery-shares"
    threshold: "-recovery-threshold"
  when: vault_auto_unseal == true

# ### LZLAB ###
# - name: set facts for lzlab
#   block:
#     - name: set dns_suffix
#       set_fact:
#         env_dns_suffix: vault.lzlab.cloud
#         vault_leader_hostname: "{{ hostvars['vault-0.vault.lzlab.cloud']['ansible_facts']['fqdn'] }}"
#   when: deployment_env == "lzlab"

# ### LZDEV ###
# - name: set facts for lzdev
#   block:
#     - name: set dns_suffix
#       set_fact:
#         env_dns_suffix: vault.lzdev.cloud
#         vault_leader_hostname: "{{ hostvars['vault-0.vault.lzdev.cloud']['ansible_facts']['fqdn'] }}"
#   when: deployment_env == "lzdev"

# ### PRO ###
# - name: set facts for pro
#   block:
#     - name: set dns_suffix
#       set_fact:
#         env_dns_suffix: vault.accor.net
#         vault_leader_hostname: "{{ hostvars['vault-0']['ansible_facts']['fqdn'] }}"
#   when: deployment_env == "pro"
